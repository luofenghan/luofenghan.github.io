<!-- build time:Sat Jun 17 2017 20:51:34 GMT+0800 (马来西亚半岛标准时间) --><!doctype html><html class="theme-next mist use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="增量更新,android,"><link rel="alternate" href="/atom.xml" title="唯有日月不灭" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1"><meta name="description" content="本文主要是对增量更新服务器端如果实现进行详细的介绍。"><meta name="keywords" content="增量更新,android"><meta property="og:type" content="article"><meta property="og:title" content="Android增量更新：服务器篇"><meta property="og:url" content="http://www.vibrancy.cn/repository/android-incremental-update-server-articles.html"><meta property="og:site_name" content="唯有日月不灭"><meta property="og:description" content="本文主要是对增量更新服务器端如果实现进行详细的介绍。"><meta property="og:image" content="http://i.imgur.com/RBOUfG0.png"><meta property="og:image" content="http://i.imgur.com/n4nI8zB.png"><meta property="og:image" content="http://i.imgur.com/sxndK1G.png"><meta property="og:image" content="http://i.imgur.com/Hgxvn4W.png"><meta property="og:image" content="http://i.imgur.com/BaJoEl0.png"><meta property="og:image" content="http://i.imgur.com/pTbSJ1G.png"><meta property="og:image" content="http://i.imgur.com/2kep1Su.png"><meta property="og:image" content="http://i.imgur.com/OytWPaJ.png"><meta property="og:image" content="http://i.imgur.com/4k1bWXg.png"><meta property="og:image" content="http://i.imgur.com/55agjAq.png"><meta property="og:image" content="http://i.imgur.com/H9elGXU.png"><meta property="og:image" content="http://i.imgur.com/gG7T8nm.png"><meta property="og:image" content="http://i.imgur.com/V2AFD3j.png"><meta property="og:image" content="http://i.imgur.com/uQiK24i.png"><meta property="og:image" content="http://i.imgur.com/NHRemD6.png"><meta property="og:image" content="http://i.imgur.com/G0Frtwr.png"><meta property="og:image" content="http://i.imgur.com/MckAKMJ.png"><meta property="og:image" content="http://i.imgur.com/oCMUkUw.png"><meta property="og:image" content="http://i.imgur.com/e9f694c.png"><meta property="og:image" content="http://i.imgur.com/eDPNUHG.png"><meta property="og:image" content="http://i.imgur.com/8INJLrO.png"><meta property="og:image" content="http://i.imgur.com/quzwfPh.png"><meta property="og:image" content="http://i.imgur.com/HSbsyVA.png"><meta property="og:image" content="http://i.imgur.com/q7Sl981.png"><meta property="og:image" content="http://i.imgur.com/1PmCkic.png"><meta property="og:image" content="http://i.imgur.com/r0003FO.png"><meta property="og:image" content="http://i.imgur.com/3LUG2ic.png"><meta property="og:image" content="http://i.imgur.com/FeEghkb.png"><meta property="og:image" content="http://i.imgur.com/sSoD3Wd.png"><meta property="og:image" content="http://i.imgur.com/EHppmhA.png"><meta property="og:image" content="http://i.imgur.com/Llrwt4j.png"><meta property="og:image" content="http://i.imgur.com/KFULVhk.png"><meta property="og:image" content="http://i.imgur.com/70bdDfk.png"><meta property="og:image" content="http://i.imgur.com/oOEXgk0.png"><meta property="og:image" content="http://i.imgur.com/ZhwlIHh.png"><meta property="og:updated_time" content="2017-05-15T11:56:10.571Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Android增量更新：服务器篇"><meta name="twitter:description" content="本文主要是对增量更新服务器端如果实现进行详细的介绍。"><meta name="twitter:image" content="http://i.imgur.com/RBOUfG0.png"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://www.vibrancy.cn/repository/android-incremental-update-server-articles.html"><title>Android增量更新：服务器篇 | 唯有日月不灭</title></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">唯有日月不灭</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>文章</a></li><li class="menu-item menu-item-tags"><a href="/tags" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-about"><a href="/about" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://www.vibrancy.cn/repository/android-incremental-update-server-articles.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="落枫寒"><meta itemprop="description" content=""><meta itemprop="image" content="http://op87q3xru.bkt.clouddn.com/self/image/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="唯有日月不灭"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Android增量更新：服务器篇</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-30T21:40:21+08:00">2017-04-30 </time></span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span></span><div class="post-description">本文主要是对增量更新服务器端如果实现进行详细的介绍。</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="增量更新的原理"><a href="#增量更新的原理" class="headerlink" title="增量更新的原理"></a>增量更新的原理</h2><p>其实增量升级的原理很简单，即首先将应用的旧版本Apk与新版本Apk做差分，得到更新的部分的补丁，例如旧版本的APK有5M，新版的有8M，更新的部分则可能只有3M左右(这里需要说明的是，得到的差分包大小并不是简单的相减，因为其实需要包含一些上下文相关的东西——有时候旧版本10M，新版本8M，得到的差分包可能有5M)，使用差分升级的好处显而易见，那么你不需要下载完整的8M文件，只需要下载更新部分就可以，而更新部分可能只有3、4M，可以很大程度上减少流量的损失。</p><p>在用户下载了差分包之后，需要在手机端将他们组合起来。可以参考的做法是先将手机端的旧版本软件(多半在/data/下)，复制到SD卡或者cache中，将它们和之前的差分patch进行组合，得到一个新版本的apk应用，如果不出意外的话，这个生成的apk和你之前做差分的apk是一致的。</p><h2 id="增量更新实现"><a href="#增量更新实现" class="headerlink" title="增量更新实现"></a>增量更新实现</h2><h3 id="使用的工具"><a href="#使用的工具" class="headerlink" title="使用的工具"></a>使用的工具</h3><p>使用开源的二进制比较工具<a href="http://www.daemonology.net/bsdiff/" target="_blank" rel="external">bsdiff</a></p><p><img src="http://i.imgur.com/RBOUfG0.png" alt=""></p><p>及其依赖的<a href="http://www.bzip.org/downloads.html" target="_blank" rel="external">bzip2</a></p><p><img src="http://i.imgur.com/n4nI8zB.png" alt="bzip2"></p><p>下载完后，得到这样的目录结构：</p><p><img src="http://i.imgur.com/sxndK1G.png" alt=""></p><p><img src="http://i.imgur.com/Hgxvn4W.png" alt=""></p><p>其中bsdiff.c用于在服务端生成差分包，bspatch.c用于在客户端把旧版本apk与服务端生成的差分包进行合成为新版本apk。</p><h3 id="实现的步骤"><a href="#实现的步骤" class="headerlink" title="实现的步骤"></a>实现的步骤</h3><ol><li>在服务端，生成新旧版本的差分包</li><li>在客户端，使用已安装的旧版apk与这个差分包，合成为一个新版apk。</li><li>校验新合成的客户端文件是否完成，签名时候和已安装客户端一致，如一致，提示用户安装;</li></ol><h2 id="服务端生成差分包"><a href="#服务端生成差分包" class="headerlink" title="服务端生成差分包"></a>服务端生成差分包</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>由于服务器的不同，因此我们需要将以上的c/c++文件，build输出为动态链接库，以供java调用，其中Window环境生成名为libApkPatchLibraryServer.dll文件，Unix/Linux环境生成名为libApkPatchLibraryServer.so，OSX下生成名为libApkPatchLibraryServer.dylib的文件。下面具体讲一下在Windows服务器上怎么生成libApkPatchLibraryServer.dll文件的</p><h3 id="生成dll动态链接库"><a href="#生成dll动态链接库" class="headerlink" title="生成dll动态链接库"></a>生成dll动态链接库</h3><ol><li><p>下载开源工具</p><p>如果我们要生成dll动态链接库，那我们就不能用刚才下的bsdiff-4.3了（具体原因下面再说），我们需要在这里<a href="http://sites.inka.de/tesla/others.html#bsdiff" target="_blank" rel="external">bsdiff</a> 下载一个针对win32版本的bsdiff文件，下载页面如图所示：</p><p><img src="http://i.imgur.com/BaJoEl0.png" alt=""></p><p>下载得到的文件如图所示：</p><p><img src="http://i.imgur.com/pTbSJ1G.png" alt=""></p><p>里面已经包含了<code>bsdiff.cpp</code>，<code>bspatch.cpp</code>及其依赖的<code>bzlip</code>等文件。</p></li><li><p>改写bsdiff.cpp（生成差分包）</p><p>首先，在MyEclispe中声明一个native方法，如图所示：</p><p><img src="http://i.imgur.com/2kep1Su.png" alt=""></p><p>接着，为了生成的方便，将该类及完整的所在包复制到桌面上，我们利用javac 和javap命令将该native方法生成c/c++中对应的.h头文件：</p><p><img src="http://i.imgur.com/OytWPaJ.png" alt=""></p><p><img src="http://i.imgur.com/4k1bWXg.png" alt=""></p><p><img src="http://i.imgur.com/55agjAq.png" alt=""></p><p>这时，我们可以看到在桌面上生成了一个<code>com_cwc_smartupdate_util_DiffUtil.h</code>的头文件。打开头文件，如下图所示：</p><p><img src="http://i.imgur.com/H9elGXU.png" alt=""></p><p>以上代码需要说明一下，首先函数名的格式遵循如下规则：<code>Java_包名_类名_方法名</code>。其中，<code>JNIEXPORT</code>、<code>JNICALL</code>、<code>JNIEnv</code>和<code>jobject</code>都是JNI标准中定义的类型或者宏。</p></li><li><p>实现JNI方法</p><p>这里可以选用c或c++实现，我们这使用的是c++，因为在上文中下载win32版本的<code>bsdiff</code>中的<code>bsdiff.cpp</code>就是用c++实现的，接着我们打开该文件进行改写。（注意：我这以下的所有操作都是基于VS2013，因为涉及到很多c和h文件的引用，如果使用命令行的话，在连接阶段可能出现函数未定义的情况，为了简便本人直接使用了VS2013来生成dll文件）。</p><p>首先，利用vs2013新建一个dll项目，将<code>bsdiff4.3-win32-src.zip</code>解压得到的文件导入该项目中，并将bsdiff.cpp重新命名为<code>com_cwc_smartupdate_util_DiffUtil.cpp</code>，另外，这里还需要三个头文件，分别是<code>jni.h</code>、<code>jni_md.h</code>（在两个在ndk里面找，可以在该ndk根文件夹子下全文搜索一下）和刚才生成的<code>com_cwc_smartupdate_util_DiffUtil.h</code>，最终得到的目录结构如下：</p><p><img src="http://i.imgur.com/gG7T8nm.png" alt=""></p><p>接着我们打开<code>com_cwc_smartupdate_util_DiffUtil.cpp</code>文件，进行我们的改写操作，首先，引入头文件：</p><p><img src="http://i.imgur.com/V2AFD3j.png" alt=""><img src="http://i.imgur.com/uQiK24i.png" alt=""></p><p>之后，把<code>typedef long pid_t</code>注释掉，并添加<code>ftello</code>和<code>fseeko</code>两个函数宏定义，如图所示：</p><p><img src="http://i.imgur.com/NHRemD6.png" alt=""></p><p>接着，我们来实现<code>com_cwc_smartupdate_util_DiffUtil.h</code>中的函数，代码如下：</p><p><img src="http://i.imgur.com/G0Frtwr.png" alt=""></p><p>这段代码意思是将传入的三个字符串（新旧版本的文件路径和生成的差分包路径）分别放进一个<code>char* 类型</code>的指针数组里面，然后调用appDiff函数，生成差分包。那这个appDiff如何实现呢，我们找到该文件下的main方法，将该main方法重命名为appDiff：</p><p><img src="http://i.imgur.com/MckAKMJ.png" alt=""></p><p><img src="http://i.imgur.com/oCMUkUw.png" alt=""></p><p>接着，把该<code>appDiff函数</code>向下拖动，会看到这段代码，这段代码用于通过打开旧版本文件，将文件的数据读到名为old的内存当中，这段代码改写如下：</p><p><img src="http://i.imgur.com/e9f694c.png" alt=""></p><p>因为<code>lseek</code>，<code>open</code>等函数都是Linux里面的，如果在window下使用会出现打开文件失败的情况。改写的文件如下，其中stream是新定义的一个<code>FILE* stream</code>;文件类型指针：</p><p><img src="http://i.imgur.com/eDPNUHG.png" alt=""></p><p>通过这段代码可以将旧版本文件数据读取到<code>u_char* old</code>中。接着，我们改写读取新文件的这段代码，代码如下：</p><p><img src="http://i.imgur.com/8INJLrO.png" alt=""></p><p>改写成：</p><p><img src="http://i.imgur.com/quzwfPh.png" alt=""></p><p>到此为止，我们的所有操作就全部完成了，接下来我们生成dll文件，在生成的dll文件中也注意是32位的还是64位的，不然在java调用的时候会出现读取失败的情况。</p><h2 id="在服务端调用dll文件"><a href="#在服务端调用dll文件" class="headerlink" title="在服务端调用dll文件"></a>在服务端调用dll文件</h2></li></ol><p><img src="http://i.imgur.com/HSbsyVA.png" alt=""></p><p>其中，<code>DiffAppServer64</code>就是刚才生成的dll文件，由于<code>DiffAppServer64.dll</code>需要依赖其他的dll文件，我这需要依赖<code>msvcr100d</code>和<code>kernel32</code>，所以在这里也必须将两个文件导入才行。最后，这三个文件放置的位置如图所示：</p><p><img src="http://i.imgur.com/q7Sl981.png" alt=""></p><p>在tomcat根目录下的bin子目录下新建一个appdiff目录，然后把三个文件放到这里。当这些所有的操作完成之后，就可以在服务端生成差分包了。</p><h2 id="运行效果展示"><a href="#运行效果展示" class="headerlink" title="运行效果展示"></a>运行效果展示</h2><h3 id="apk文件上传页面面"><a href="#apk文件上传页面面" class="headerlink" title="apk文件上传页面面"></a>apk文件上传页面面</h3><p><img src="http://i.imgur.com/1PmCkic.png" alt=""></p><h3 id="旧版本文件上传"><a href="#旧版本文件上传" class="headerlink" title="旧版本文件上传"></a>旧版本文件上传</h3><p><img src="http://i.imgur.com/r0003FO.png" alt=""></p><h3 id="新版本文件上传"><a href="#新版本文件上传" class="headerlink" title="新版本文件上传"></a>新版本文件上传</h3><p><img src="http://i.imgur.com/3LUG2ic.png" alt=""></p><h3 id="当上传新版本后，服务端后台就自动开始生成差分包的工作了"><a href="#当上传新版本后，服务端后台就自动开始生成差分包的工作了" class="headerlink" title="当上传新版本后，服务端后台就自动开始生成差分包的工作了"></a>当上传新版本后，服务端后台就自动开始生成差分包的工作了</h3><p><img src="http://i.imgur.com/FeEghkb.png" alt=""></p><p><img src="http://i.imgur.com/sSoD3Wd.png" alt=""></p><p>那么又涉及到另外一个问题，由于比较生成差分包在底层进行，并且非常的耗时，大概需要1分多钟，那么如何显示进度，生成差分包的工作进行到哪一步了？这就需要利用jni调用java方法，将底层的信息传到java代码层。</p><h2 id="jni调用java方法，回传底层的进度信息"><a href="#jni调用java方法，回传底层的进度信息" class="headerlink" title="jni调用java方法，回传底层的进度信息"></a>jni调用java方法，回传底层的进度信息</h2><ol><li><p>在声明genDiff 这个native方法的的类中<code>java.cwc.smartupdate.util.DiffUtil</code>声明一个静态的方法：</p><p><img src="http://i.imgur.com/EHppmhA.png" alt=""></p><p>这个方法表示，在c底层进行调用该方法，传递整型state参数，通过对比不同的整型数据，找到底层对应的执行进度。</p></li><li><p>让我们返回到<code>com_cwc_smartupdate_util_DiffUtil.cpp</code>文件中，找到我们在上文中实现的本地方法对应的函数：</p><p><img src="http://i.imgur.com/Llrwt4j.png" alt=""></p><p>为了方便演示，在这个函数上面定义一个用于发布进度的函数：</p><p><img src="http://i.imgur.com/KFULVhk.png" alt=""></p><p>这段函数的意思就是通过反射来调用DiffUtil类内的静态方法publishProgress，然后在appDiff函数内部，就可以在关键的地方调用该函数用来发布当前执行任务的状态了，（注意定义的函数需要在该文件头部声明，不然出现找不到函数的错误提示），另外还有一点需要注意，publishProgress需要调用不止一次，因此不可能每次都通过反射来创建DiffUtil的类对象(创建一次就够了)，因此，我们需要将上面的函数整理为以下格式：</p><p><img src="http://i.imgur.com/70bdDfk.png" alt=""></p></li><li><p>服务端的java代码层</p><p>由于publishProgress传递的是整型数据，我们可以自定义一些整型常量来映射出对应的任务状态。还可以在该DiffUtil定义一个内部接口，这样其他类实现了该接口，就可以接收到底层返回的进度。</p><p><img src="http://i.imgur.com/oOEXgk0.png" alt=""></p><p><img src="http://i.imgur.com/ZhwlIHh.png" alt=""></p></li></ol><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>到此为止，整个增量更新的服务端是实现就结束了，总结一下：</p><ul><li>我们首先在java中定义了一个本地native方法，通过javac和javap命令生成了对应的h头文件；</li><li>然后改写bsdiff.cpp文件，实现刚才生成的头文件中的函数，并针对windows服务器改写bsdiff.cpp的函数内部的细节；</li><li>最后进行将生成的dll文件放到了tomcat服务器中，利用System.loadLibrary函数加载dll文件，如果缺少依赖dll的话，就添加对应的dll文件；</li><li>最后为了实现进度的显示，我们又定义了publishProgress方法，并在底层实现了该函数，在java端的DiffUtil类中定义了一个接口，让其他实现该接口的类可以接收到底层发布的进度。</li></ul></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/增量更新/" rel="tag"># 增量更新</a> <a href="/tags/android/" rel="tag"># android</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/repository/when-to-use-MQ .html" rel="next" title="到底什么时候该使用MQ"><i class="fa fa-chevron-left"></i> 到底什么时候该使用MQ</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/repository/java8-HashMap-principle-analysis.html" rel="prev" title="Java8 HashMap原理分析">Java8 HashMap原理分析 <i class="fa fa-chevron-right"></i></a></div></div></footer></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview">站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="http://op87q3xru.bkt.clouddn.com/self/image/avatar.png" alt="落枫寒"><p class="site-author-name" itemprop="name">落枫寒</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives"><span class="site-state-item-count">9</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">16</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#增量更新的原理"><span class="nav-number">1.</span> <span class="nav-text">增量更新的原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#增量更新实现"><span class="nav-number">2.</span> <span class="nav-text">增量更新实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用的工具"><span class="nav-number">2.1.</span> <span class="nav-text">使用的工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现的步骤"><span class="nav-number">2.2.</span> <span class="nav-text">实现的步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#服务端生成差分包"><span class="nav-number">3.</span> <span class="nav-text">服务端生成差分包</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介"><span class="nav-number">3.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成dll动态链接库"><span class="nav-number">3.2.</span> <span class="nav-text">生成dll动态链接库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在服务端调用dll文件"><span class="nav-number">4.</span> <span class="nav-text">在服务端调用dll文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运行效果展示"><span class="nav-number">5.</span> <span class="nav-text">运行效果展示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#apk文件上传页面面"><span class="nav-number">5.1.</span> <span class="nav-text">apk文件上传页面面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#旧版本文件上传"><span class="nav-number">5.2.</span> <span class="nav-text">旧版本文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#新版本文件上传"><span class="nav-number">5.3.</span> <span class="nav-text">新版本文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#当上传新版本后，服务端后台就自动开始生成差分包的工作了"><span class="nav-number">5.4.</span> <span class="nav-text">当上传新版本后，服务端后台就自动开始生成差分包的工作了</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jni调用java方法，回传底层的进度信息"><span class="nav-number">6.</span> <span class="nav-text">jni调用java方法，回传底层的进度信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#结论"><span class="nav-number">7.</span> <span class="nav-text">结论</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2017</span> <span class="author" itemprop="copyrightHolder"><a href="http://www.vibrancy.cn">落枫寒</a>&nbsp;版权所有</span></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html><!-- rebuild by neat -->